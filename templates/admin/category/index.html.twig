{% extends 'admin/_store_components/layout.html.twig' %}

{% block title %}Category list{% endblock %}

{% set table_actions %}
    {% if is_granted('ROLE_STORE_ADMIN') %}
        <a class="dropdown-item" href="{{ path('admin_category_new', {store_id: app.request.get('store_id')}) }}">New</a>
    {% endif %}
{% endset %}

{% set table_head %}
    <tr>
        <th>Name</th>
    </tr>
{% endset %}

{% set table_body %}
    {% for entity in pagination %}
        <tr
                id="{{ entity.id }}"
                data-id-column="id"
                class="{{ entity.id == first_entity.id ? 'table-active' : '' }}"
                data-action="click->reload-card#reloadCard click->reload-card#tableActivate"
                data-link="{{ path('admin_category_show', {store_id: app.request.get('store_id'), id: entity.id}) }}"
                onclick="document.getElementById('first-tab').click()"
        >
            {% if entity.level > 0 %}
                <td class="{{ 'ps-'~(entity.level + 3) }}"><i class="fa-solid fa-angles-right"></i>{{ entity.name }}</td>
            {% else %}
                <td>{{ entity.name }}</td>

            {% endif %}
        </tr>
    {% endfor %}
{% endset %}

{% block main_content %}
    <main class="content" {{ stimulus_controller('reload-card') }}>
        <div class="container-fluid p-0">
            <div class="row">
                <div class="col-xxl-4 col-xl-5 col-lg-6">
                    {% if pagination.count > 0 %}
                        {{ include('admin/_components/card/_tab_card.html.twig', {
                            tab_head: [
                                include('admin/_components/tab_icon/_show.html.twig'),
                                include('admin/_components/tab_icon/_filter.html.twig')
                                ~ (app.request.get(filter_form.vars.name) ? '<span style="color: red">*</span>' : '')
                            ],
                            tab_body: first_entity ? [
                                render(controller(
                                    'App\\Controller\\Admin\\CategoryController::show',
                                    { store_id: app.request.get('store_id'),'id': first_entity.id, 'request': app.request }
                                )),
                                include('admin/_components/card/_filter_card.html.twig', {form: filter_form})
                            ] : []
                        }) }}
                    {% else %}
                        Nothing to show...
                    {% endif %}
                </div>
                <div class="col-xxl-8 col-xl-7 col-lg-6">
                    {{ include('admin/_components/card/_table_card.html.twig', {
                        actions: table_actions,
                        table_title: 'Categories',
                        table_head: table_head,
                        table_body: table_body
                    }) }}
                </div>
            </div>
        </div>
    </main>
{% endblock %}